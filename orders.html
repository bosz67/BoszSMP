<!DOCTYPE html>
<html lang="nl">

<head>
  <meta charset="UTF-8" />
  <title>Bestellingen Overzicht</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root {
      --accent: #6dd3ff;
      --dark: #0f1724;
      --muted: #94a3b8;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      margin: 0;
      background: linear-gradient(180deg, #071024 0%, #071827 100%);
      color: #e6eef6;
      padding: 28px;
    }

    h1 {
      color: var(--accent);
      text-align: center;
      margin-bottom: 18px;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
    }

    /* Nav styling */
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .nav-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .nav-left .logo {
      width: 32px;
      height: 32px;
    }

    .nav-left .brand {
      font-size: 22px;
      font-weight: 700;
      color: var(--accent);
    }

    .nav-right button {
      background: var(--dark);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: #e6eef6;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      margin-left: 8px;
    }

    .nav-right button.active {
      background: var(--accent);
      color: #042233;
    }

    .order {
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(0, 0, 0, 0.12));
      border: 1px solid rgba(255, 255, 255, 0.05);
      padding: 16px;
      margin: 12px 0;
      border-radius: 12px;
      color: #e6eef6;
    }

    .order strong {
      color: var(--accent);
      display: block;
      margin-bottom: 6px;
    }

    .order ul {
      margin: 8px 0 0 20px;
      padding: 0;
      color: var(--muted);
    }

    .meta {
      color: var(--muted);
      margin-top: 6px;
    }

    .status {
      font-weight: 700;
    }

    .status.In\ afwachting {
      color: orange;
    }

    .status.Goedgekeurd {
      color: lightgreen;
    }

    .status.Geweigerd {
      color: #ff6b6b;
    }

    .controls {
      margin-top: 10px;
    }

    button {
      cursor: pointer;
      padding: 8px 12px;
      border-radius: 8px;
      border: 0;
      margin-right: 8px;
      font-weight: 600;
    }

    button.approve {
      background: lightgreen;
      color: #042233;
    }

    button.reject {
      background: #ff6b6b;
      color: #fff;
    }

    button.delete {
      background: var(--accent);
      color: #042233;
    }

    .cards {
      display: none;
    }

    .category {
      margin: 20px 0;
    }

    .category h2 {
      color: var(--accent);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .product-toggle {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(255, 255, 255, 0.05);
      padding: 10px;
      border-radius: 8px;
      margin: 6px 0;
    }

    .product-toggle span {
      font-weight: 500;
    }

    footer {
      margin-top: 28px;
      text-align: center;
      color: var(--muted);
      font-size: 14px;
    }

    /* Password modal */
    .modal-backdrop {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal-backdrop.show {
      display: flex;
    }

    .modal-box {
      background: linear-gradient(180deg, #061422, #041826);
      border-radius: 12px;
      padding: 20px;
      width: 100%;
      max-width: 420px;
      color: #e6eef6;
      box-shadow: 0 12px 40px rgba(2, 6, 23, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.04);
    }

    .modal-box h2 {
      margin: 0 0 12px;
      color: var(--accent);
    }

    .modal-box p {
      margin: 0 0 12px;
      color: var(--muted);
    }

    .modal-box input[type="password"] {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      background: rgba(255, 255, 255, 0.02);
      color: #fff;
      margin-bottom: 12px;
      outline: none;
    }

    .modal-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }

    .btn-ghost {
      background: transparent;
      color: var(--muted);
      border: 1px solid rgba(255, 255, 255, 0.04);
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
    }

    .btn-primary {
      background: var(--accent);
      color: #042233;
      padding: 8px 12px;
      border-radius: 8px;
      border: 0;
      cursor: pointer;
      font-weight: 600;
    }

    .error {
      color: #ffb3b3;
      margin-top: 8px;
      font-size: 14px;
    }
  </style>
</head>

<body>
  <div class="container">

    <!-- Navigatie -->
    <nav class="navbar">
      <div class="nav-left">
        <img src="https://cdn-icons-png.flaticon.com/512/3081/3081559.png" alt="logo" class="logo">
        <span class="brand">Beheeromgeving</span>
      </div>
      <div class="nav-right">
        <button id="tabOrders" class="active">Bestellingen</button>
        <button id="tabApproved">Goedgekeurd</button>
        <button id="tabProducts">Producten</button>
      </div>
    </nav>

    <!-- Bestellingen -->
    <div id="ordersSection">
      <div id="ordersList">Laden...</div>
    </div>

    <!-- Goedgekeurde bestellingen -->
    <div id="approvedSection" class="cards">
      <div id="approvedList">Laden...</div>
    </div>

    <!-- Producten -->
    <div id="productsSection" class="cards">
      <div id="productsContainer"></div>
    </div>

    <footer>© 2025 BOSZ Shop — Beheeromgeving</footer>
  </div>

  <!-- Password modal -->
  <div id="pwModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="pwTitle">
    <div class="modal-box">
      <h2 id="pwTitle">Voer wachtwoord in</h2>
      <p>Voer het beheerderswachtwoord in om deze pagina te bekijken.</p>
      <input id="pwInput" type="password" placeholder="Wachtwoord" autocomplete="current-password" />
      <div class="error" id="pwError" style="display:none"></div>
      <div class="modal-actions">
        <button class="btn-ghost" id="pwCancel">Annuleren</button>
        <button class="btn-primary" id="pwSubmit">Inloggen</button>
      </div>
    </div>
  </div>

  <script>
    /* ========= Config ========= */
    const wachtwoord = "geheim123";

    /* ========= Elements ========= */
    const ordersListEl = document.getElementById('ordersList');
    const approvedListEl = document.getElementById('approvedList');
    const pwModal = document.getElementById('pwModal');
    const pwInput = document.getElementById('pwInput');
    const pwError = document.getElementById('pwError');
    const pwSubmit = document.getElementById('pwSubmit');
    const pwCancel = document.getElementById('pwCancel');

    const tabOrders = document.getElementById("tabOrders");
    const tabApproved = document.getElementById("tabApproved");
    const tabProducts = document.getElementById("tabProducts");
    const ordersSection = document.getElementById("ordersSection");
    const approvedSection = document.getElementById("approvedSection");
    const productsSection = document.getElementById("productsSection");
    const productsContainer = document.getElementById("productsContainer");

    /* ========= Tabs ========= */
    function activateTab(tab) {
      [tabOrders, tabApproved, tabProducts].forEach(b => b.classList.remove("active"));
      [ordersSection, approvedSection, productsSection].forEach(s => s.style.display = "none");

      if (tab === "orders") {
        tabOrders.classList.add("active");
        ordersSection.style.display = "block";
      } else if (tab === "approved") {
        tabApproved.classList.add("active");
        approvedSection.style.display = "block";
      } else if (tab === "products") {
        tabProducts.classList.add("active");
        productsSection.style.display = "block";
        renderProducts();
      }
    }

    tabOrders.addEventListener("click", () => activateTab("orders"));
    tabApproved.addEventListener("click", () => activateTab("approved"));
    tabProducts.addEventListener("click", () => activateTab("products"));

    /* ========= Password Modal ========= */
    window.addEventListener('DOMContentLoaded', () => {
      showPasswordModal();
      pwInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') tryLogin(); });
      pwSubmit.addEventListener('click', tryLogin);
      pwCancel.addEventListener('click', () => {
        document.body.innerHTML = '<div style="padding:28px;color:var(--muted);"><h1>Toegang geweigerd</h1></div>';
      });
    });
    function showPasswordModal() { pwError.style.display = 'none'; pwInput.value = ''; pwModal.classList.add('show'); setTimeout(() => pwInput.focus(), 200); }
    function hidePasswordModal() { pwModal.classList.remove('show'); }
    function tryLogin() {
      if (pwInput.value === wachtwoord) { hidePasswordModal(); loadOrders(); }
      else { pwError.style.display = 'block'; pwError.textContent = 'Onjuist wachtwoord.'; }
    }

    /* ========= Orders logic ========= */
    function loadOrders() {
      let orders = JSON.parse(localStorage.getItem("orders")) || [];
      let changed = false;
      orders.forEach((o, i) => {
        if (!o.id) { o.id = Date.now() + i; changed = true; }
        if (!o.status) { o.status = "In afwachting"; changed = true; }
      });
      if (changed) localStorage.setItem("orders", JSON.stringify(orders));

      ordersListEl.innerHTML = "";
      approvedListEl.innerHTML = "";

      if (orders.length === 0) {
        ordersListEl.innerHTML = '<p style="color:var(--muted)">Geen bestellingen gevonden.</p>';
        approvedListEl.innerHTML = '<p style="color:var(--muted)">Geen goedgekeurde bestellingen.</p>';
        return;
      }

      orders.forEach((order, i) => {
        const items = order.cart || order.items || [];
        const productsHtml = items.map(it => {
          const nm = it.name || it.title || it.product || "Onbekend";
          return `<li>${it.qty || 1}× ${nm} - €${((it.price || 0) * (it.qty || 1)).toFixed(2)}</li>`;
        }).join("");
        const total = items.reduce((s, it) => s + ((it.price || 0) * (it.qty || 1)), 0);

        const html = `
          <div class="order">
            <strong>Bestelling ${i + 1}</strong>
            <div class="meta">Naam: ${order.name || 'Onbekend'} • Email: ${order.email || 'Onbekend'} • Datum: ${order.date || 'Onbekend'}</div>
            <div style="margin-top:8px">Status: <span class="status ${order.status}">${order.status}</span></div>
            <div style="margin-top:8px">
              <div>Producten:</div>
              <ul>${productsHtml}</ul>
              <p><strong>Totaal:</strong> €${total.toFixed(2)}</p>
            </div>
            <div class="controls">
              <button class="approve" onclick="updateStatus(${order.id}, 'Goedgekeurd')">✅ Goedkeuren</button>
              <button class="reject" onclick="updateStatus(${order.id}, 'Geweigerd')">❌ Weigeren</button>
              <button class="delete" onclick="deleteOrder(${order.id})">🗑️ Verwijderen</button>
            </div>
          </div>`;

        if (order.status === "Goedgekeurd") {
          approvedListEl.innerHTML += html;
        } else {
          ordersListEl.innerHTML += html;
        }
      });

      if (!approvedListEl.innerHTML.trim()) {
        approvedListEl.innerHTML = '<p style="color:var(--muted)">Geen goedgekeurde bestellingen.</p>';
      }
      if (!ordersListEl.innerHTML.trim()) {
        ordersListEl.innerHTML = '<p style="color:var(--muted)">Geen bestellingen (in afwachting/geweigerd).</p>';
      }
    }

    function updateStatus(id, st) {
      let orders = JSON.parse(localStorage.getItem("orders")) || [];
      const o = orders.find(x => x.id === id);
      if (!o) return;

      o.status = st;
      localStorage.setItem("orders", JSON.stringify(orders));

      // Stuur ook webhook
      sendWebhook(o, st);

      loadOrders();
    }

    function deleteOrder(id) {
      let orders = JSON.parse(localStorage.getItem("orders")) || [];
      orders = orders.filter(o => o.id !== id);
      localStorage.setItem("orders", JSON.stringify(orders));
      loadOrders();
    }

    /* ========= Webhook ========= */
function sendWebhook(order) {
  const total = (order.cart || order.items || []).reduce((s, it) => s + (it.price || 0) * (it.qty || 1), 0);
  const items = (order.cart || order.items || []).map(it => `${it.qty}× ${it.title || it.name}`).join(", ");

  const embed = {
    title: "New donation! 🎉",
    description: `Thank you **${order.name}** for the purchase of **${items}** for a total of **€${total.toFixed(2)}**!`,
    color: 0x57F287
  };

  fetch("https://discord.com/api/webhooks/1422274875569078392/KX9p1LU9lwq9_4MbhM8kB9r0FU2EJMDd26t5FwEx-qlJ0qHXMDzI9hR4uwM_nsLXELkI", {

    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ embeds: [embed] })
  })
    .then(r => r.json())
    .then(j => console.log("✅ Discord response:", j))
    .catch(err => console.error("❌ Webhook error:", err));
}




  /* ========= Producten logic ========= */
  const DATA = JSON.parse(localStorage.getItem("DATA")) || { products: [] };
  const categories = {
    1: "Ranks",
    2: "Keys",
    3: "Vaults",
    4: "Bundles",
    5: "Commands",
    6: "Extra",
    7: "Boosters"
  };

  function renderProducts() {
    let disabled = JSON.parse(localStorage.getItem("disabledProducts")) || [];
    if (!DATA.products.length) {
      productsContainer.innerHTML = "<p style='color:var(--muted)'>Geen producten gevonden.</p>";
      return;
    }

    const grouped = {};
    DATA.products.forEach(p => {
      if (!grouped[p.category]) grouped[p.category] = [];
      grouped[p.category].push(p);
    });

    productsContainer.innerHTML = Object.keys(grouped).map(catId => {
      const list = grouped[catId];
      const allEnabled = list.every(prod => !disabled.includes(prod.id));

      return `
        <div class="category">
          <h2>
            ${categories[catId] || "Categorie " + catId}
            <input type="checkbox" ${allEnabled ? "checked" : ""} onchange="toggleCategory(${catId}, this.checked)">
          </h2>
          ${list.map(prod => {
        const isDisabled = disabled.includes(prod.id);
        return `<div class="product-toggle">
                  <span>${prod.title} — €${prod.price}</span>
                  <input type="checkbox" ${isDisabled ? "" : "checked"} onchange="toggleProduct(${prod.id}, this.checked)">
                </div>`;
      }).join("")}
        </div>`;
    }).join("");
  }

  function toggleProduct(id, enabled) {
    let disabled = JSON.parse(localStorage.getItem("disabledProducts")) || [];
    if (!enabled && !disabled.includes(id)) disabled.push(id);
    if (enabled) disabled = disabled.filter(x => x !== id);
    localStorage.setItem("disabledProducts", JSON.stringify(disabled));
  }

  function toggleCategory(catId, enabled) {
    let disabled = JSON.parse(localStorage.getItem("disabledProducts")) || [];
    const products = DATA.products.filter(p => p.category == catId);

    if (enabled) {
      disabled = disabled.filter(id => !products.some(p => p.id === id));
    } else {
      products.forEach(p => {
        if (!disabled.includes(p.id)) disabled.push(p.id);
      });
    }

    localStorage.setItem("disabledProducts", JSON.stringify(disabled));
    renderProducts(); // UI direct updaten
  }

  /* ========= Orders & Donator logic ========= */
  function loadRecentOrders() {
    let orders = JSON.parse(localStorage.getItem("orders")) || [];
    let list = document.getElementById("recentOrdersList");
    if (!list) return;

    if (orders.length === 0) {
      list.innerHTML = "<p>Geen bestellingen geplaatst.</p>";
      return;
    }

    let recent = orders.slice(-6).reverse();

    let html = "";
    recent.forEach(order => {
      html += `
        <div class="card">
          <h3>${order.name}</h3>
          <p class="status" style="font-weight:bold;color:${
            order.status === "Goedgekeurd" ? "limegreen" :
            order.status === "Geweigerd" ? "red" : "orange"
          }">${order.status || "In afwachting"}</p>
        </div>
      `;
    });

    list.innerHTML = html;
  }

  function updateTopDonator() {
    let orders = JSON.parse(localStorage.getItem("orders")) || [];
    let totals = {};

    orders.forEach(order => {
      if (order.status === "Goedgekeurd") {
        let total = (order.cart || []).reduce((sum, item) => sum + (item.qty * item.price), 0);
        if (order.name) {
          totals[order.name] = (totals[order.name] || 0) + total;
        }
      }
    });

    let topName = null;
    let topAmount = 0;
    for (let name in totals) {
      if (totals[name] > topAmount) {
        topAmount = totals[name];
        topName = name;
      }
    }

    let card = document.getElementById("topDonatorCard");
    if (!card) return;

    if (topName) {
      card.innerHTML = `
        <h3>${topName}</h3>
        <p><strong>Totaal gedoneerd:</strong> €${topAmount.toFixed(2)}</p>
      `;
    } else {
      card.innerHTML = "<p>Nog geen donaties goedgekeurd.</p>";
    }
  }

  /* ========= Init ========= */
  document.addEventListener("DOMContentLoaded", () => {
    renderProducts();
    loadRecentOrders();
    updateTopDonator();
  });

  window.addEventListener("storage", (event) => {
    if (event.key === "orders") {
      loadRecentOrders();
      updateTopDonator();
    }
    if (event.key === "disabledProducts" || event.key === "DATA") {
      renderProducts();
    }
  });
  
  </script>
</body>

</html>
